# Claude Behavior Guidelines for ffai

## Python Virtual Environment

This repo uses a virtual environment at `.venv/`. Always use it when running Python commands:

```bash
.venv/bin/python   # instead of python / python3
.venv/bin/pip      # instead of pip
```

The package is installed in editable mode (`pip install -e ffai/`), so source changes in `ffai/src/` take effect immediately without reinstalling.

PufferLib is installed from source at `/home/dave/code/public/PufferLib/` (required for PyTorch ABI compatibility — do not install from PyPI).

## Data Directory Convention

- `ffai/src/ffai/data/{league_name}/` — files downloaded directly from ESPN. Never modify these; only append new years. (`league_name` comes from `config/league.yaml`)
- `ffai/src/ffai/data/nflverse/` — files downloaded from nflverse via nflreadpy. Never modify; re-run `scripts/fetch_nfl_data.py` to update.
- `ffai/src/ffai/data/{league_name}_processed/` — files derived from raw data (joins, aggregations, feature engineering). Generated by `scripts/build_features.py`; reproducible from raw.

All three directories are gitignored (local only). When adding a processing step, write a script that reads from `{league_name}/` or `nflverse/` and writes to `{league_name}_processed/` so the transformation is auditable.

## README AND MODEL Maintenance

Keep `README.md` and `MODEL.md` up to date whenever you make changes that affect:
- The training pipeline (new stages, changed script names or arguments)
- The directory structure (new files, renamed paths)
- The architecture (new models, state dimensions, data sources)
- Setup instructions (new dependencies, environment steps)

The README file should give a high level human readable explanation of this repo, the MODEL file should give a detailed design of the RL model being trained. README should be easy to understand, MODEL should be detail rich and give enough information to understand the machine learning aspects of this project.

Update the README and MODEL as part of the same commit as the code change — don't leave it for later.

## Plans

Whenever a plan is created for this project, save it as a markdown file in the `plans/` directory using the format:

```
plans/YYYY-MM-DD_{short description}.md
```

Example: `plans/2026-02-18_rl-training-refactor.md`

When implementing a plan save the plan file first, then proceed to implement the associated code.
